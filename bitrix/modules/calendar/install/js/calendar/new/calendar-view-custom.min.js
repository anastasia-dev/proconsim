(function(t){var e=t.BXEventCalendarView;function i(t,i){e.apply(this,arguments);this.appView=i;this.name="custom_"+i.ID;this.type="custom";this.placementCode=this.calendar.util.config.placementParams.gridPlacementCode;this.title=i.TITLE||this.appView.APP_NAME||BX.message("EC_REQUEST_APP_NONAME_TAB");this.contClassName="calendar-custom-view";this.preBuild()}i.prototype=Object.create(e.prototype);i.prototype.constructor=i;i.prototype.preBuild=function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName},style:{display:"none"}});var t=BX.rest.AppLayout.initializePlacement(this.placementCode);if(t){t.prototype.getEvents=BX.proxy(this.appGetEntries,this);t.prototype.viewEvent=BX.proxy(this.appViewEvent,this);t.prototype.addEvent=BX.proxy(this.appAddEvent,this);t.prototype.editEvent=BX.proxy(this.appEditEvent,this);t.prototype.deleteEvent=BX.proxy(this.appDeleteEvent,this);t.prototype.events.push("test")}};i.prototype.build=function(){this.titleCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-custom-view-title"}}));this.appWrap=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-app-wrap"},style:{height:this.calendar.util.getViewHeight()+"px"}}))};i.prototype.adjustViewRangeToDate=function(){this.show();this.appLoader=this.appWrap.appendChild(BX.adjust(this.calendar.util.getLoader(),{style:{height:"100px"}}));this.appRequestIsRunning=true;BX.ajax({url:this.calendar.util.config.placementParams.serviceUrl,method:"POST",dataType:"html",data:{LOADER_ID:Math.round(Math.random()*1e6),PARAMS:{params:{ID:this.appView.APP_ID,PLACEMENT:this.calendar.util.config.placementParams.gridPlacementCode,PLACEMENT_ID:this.appView.ID,PLACEMENT_OPTIONS:{}}}},onsuccess:BX.delegate(this.appRequestOnSuccess,this),onfailure:BX.delegate(this.appRequestOnFailure,this)})};i.prototype.appRequestOnSuccess=function(t){BX.remove(this.appLoader);this.appRequestIsRunning=false;BX.html(this.appWrap,t).then(BX.defer(function(){var t=BX.rest.AppLayout.get(this.calendar.util.config.placementParams.gridPlacementCode);if(t){t.allowInterface(["resizeWindow"])}},this))};i.prototype.appRequestOnFailure=function(){BX.remove(this.appLoader);this.appRequestIsRunning=false;this.appWrap.innerHTML='<div class="ui-alert ui-alert-warning"><span class="ui-alert-message">'+BX.message("EC_REQUEST_APP_FAILURE").replace("#APPNAME#",this.appView.APP_NAME)+"</span></div>"};i.prototype.appGetEntries=function(t,e){var i=new Date(t.dateFrom)||new Date,a=new Date(t.dateTo)||new Date(i.getFullYear(),i.getMonth()+1,i.getDate());i.setHours(0,0,0,0);a.setHours(0,0,0,0);this.calendar.setDisplayedViewRange({start:i,end:a});this.entries=this.entryController.getList({startDate:i,finishDate:a,viewRange:this.calendar.getDisplayedViewRange(),finishCallback:BX.delegate(function(t){t.entries.forEach(function(t){t.UID=this.calendar.entryController.getUniqueId(t)},this);this.entries=this.entryController.getList({startDate:i,finishDate:a,viewRange:this.calendar.getDisplayedViewRange()});if(BX.type.isArray(this.entries)){var s,n;for(s=0;s<this.entries.length;s++){n=this.entries[s];this.entriesIndex[n.uid]=s}}e(t.entries)},this)});if(BX.type.isArray(this.entries)){var s=[];this.entries.forEach(function(t){t.data.UID=this.calendar.entryController.getUniqueId(t.data);s.push(t.data)},this);e(s);var n,r;for(n=0;n<this.entries.length;n++){r=this.entries[n];this.entriesIndex[r.uid]=n}}};i.prototype.getEntryByParams=function(t){var e=t.uid;if(!e&&t.id){if(t.dateFrom&&this.getEntryById(t.id+"|"+t.dateFrom)){e=t.id+"|"+t.dateFrom}else if(this.getEntryById(t.id)){e=t.id}}return this.getEntryById(e)||false};i.prototype.appViewEvent=function(t,e){var i=this.getEntryByParams(t);if(i){this.showViewSlider({entry:i})}e({result:!!i})};i.prototype.appAddEvent=function(t,e){this.showEditSlider();e({result:true})};i.prototype.appEditEvent=function(t,e){var i=this.getEntryByParams(t);if(i){this.calendar.entryController.editEntry({entry:i})}e({result:!!i})};i.prototype.appDeleteEvent=function(t,e){var i=this.getEntryByParams(t);if(i){this.calendar.entryController.deleteEntry(i)}e()};if(t.BXEventCalendar){t.BXEventCalendar.CalendarCustomView=i}else{BX.addCustomEvent(t,"onBXEventCalendarInit",function(){t.BXEventCalendar.CalendarCustomView=i})}})(window);